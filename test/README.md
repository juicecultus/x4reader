# MicroReader Test Suite

This directory contains the test suite for the MicroReader e-ink display project. Tests validate text layout, word providers, pagination, rendering, and parsing functionality using mocked Arduino APIs. No hardware required.

## Directory Structure

```
test/
├── unit/                      # Test source files organized by component
│   ├── epub/                 # EPUB-related tests
│   ├── hyphenation/          # Hyphenation tests
│   ├── layout/               # Layout algorithm tests
│   ├── parsing/              # XML and conversion tests
│   └── wordprovider/         # Word provider tests
├── mocks/                     # Mock implementations for host testing
│   ├── Arduino.h             # Arduino API compatibility layer
│   ├── WString.h             # Arduino String mock
│   ├── SD.h                  # SD card file system mock
│   ├── platform_stubs.h      # Platform-specific stubs
│   └── platform_stubs.cpp    # Platform stub implementations
├── common/                    # Shared test utilities
│   ├── test_config.h         # Configuration constants
│   ├── test_factory.h        # Test factory utilities
│   ├── test_globals.h        # Global test state
│   ├── test_utils.cpp        # Test utilities implementation
│   └── test_utils.h          # Common test utilities and TestRunner
├── data/                      # Test data files
├── output/                    # Generated test output (PBM images, logs)
├── build/                     # Compiled test executables (generated by CMake)
└── scripts/                   # Build and run scripts
    ├── build_tests.ps1       # Windows build script
    ├── build_tests.sh        # Unix build script
    ├── run_tests.ps1         # Windows run script
    └── run_tests.sh          # Unix run script
```

## Available Tests

| Test | Component | Description |
|------|-----------|-------------|
| `EpubMemoryTest` | EPUB | Tests EPUB memory usage and loading |
| `EpubReaderTest` | EPUB | Validates EPUB file reading and parsing |
| `FileWordProviderNavigationTest` | Word Provider | Tests file-based word navigation |
| `GreedyLayoutBidirectionalParagraphTest` | Layout | Validates greedy layout paragraph handling |
| `HyphenationEvaluationTest` | Hyphenation | Evaluates hyphenation rules (English/German) |
| `SimpleXmlParserTest` | Parsing | Tests XML parsing functionality |
| `TextLayoutPageRenderTest` | Layout | Tests page layout and pagination with rendering |
| `WordProviderSeekTest` | Word Provider | Validates word provider seeking capabilities |
| `WordProviderTest` | Word Provider | Tests basic word tokenization and navigation |
| `XhtmlToTxtConversionTest` | Parsing | Tests XHTML to plain text conversion |

## Running Tests

Tests use CMake for building and are run on the host machine.

### Build and Run All Tests

**macOS/Linux:**
```bash
# From repository root
test/scripts/build_tests.sh
test/scripts/run_tests.sh
```

**Windows (PowerShell):**
```powershell
# From repository root
test\scripts\build_tests.ps1
test\scripts\run_tests.ps1
```

### Run Individual Tests

After building, executables are in `test/build/bin/Debug/` (or `Release`).

**Windows:**
```powershell
& '.\test\build\bin\Debug\WordProviderTest.exe'
```

**Unix:**
```bash
./test/build/bin/Debug/WordProviderTest
```

### Using VS Code Tasks

- `Build All Tests`: Compiles all tests
- `Run All Tests`: Builds and runs all tests
- `Run Selected Test`: Builds and runs a specific test (prompts for selection)

### Test Output

- Successful tests show `✓ ALL TESTS PASSED`
- Failed tests show `✗ FAIL` with details
- Rendering tests generate PBM images in `test/output/`
- Exit code 0 = success, non-zero = failure

## Requirements

- **CMake**: 3.16+
- **Compiler**: GCC/Clang (Unix) or MSVC/MinGW (Windows) with C++17 support
- **PowerShell**: 5.1+ (Windows)
- **Bash**: Unix-like systems

## Notes

- Tests mock Arduino APIs for host execution
- No hardware or ESP32 required
- Deterministic and single-threaded
- Rendering tests save visual output for verification
- CI/CD ready with proper exit codes

